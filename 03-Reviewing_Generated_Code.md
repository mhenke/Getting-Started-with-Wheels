## Reviewing Generated Code

We have installed Wheels and created a simple application for blog
entries. This next several sections of the article will show, review,
and explain Wheels code generated by the scaffolding plugin. We will
look at the Listing, Create, Show, Edit, and Delete functionality.

### Listing entries

We will start by looking at the functionality listing all the entries.
Open /controllers/entries.cfc and look at the index action:
 
<cffunction name="index">
<cfset entries = model("Entry").findAll()>
</cffunction>

 This code returns all records from the entries table. It uses the built
in Wheels ORM. Entry is our table name. model() is a Wheels ORM function
and findAll() is a Wheels Model class.

If you browse to the Listing entries page, you can see listing the
entries in work. Wheels makes the VARIABLES scope available from the
controller's action to the view. The view being displayed corresponds to
the action's name.

Notice the view is rendered by convention. The index action didn't have
to say render /views/entries/index.cfm.

Here's /views/entries/index.cfm:

<cfoutput><p>#linkTo(text="Home", route="home")#</p></cfoutput>

<h1>Listing entries</h1>

<cftable query="entries" colHeaders="true" HTMLTable="true">
<cfcol header="Entry I D" text="#entryID#" />
<cfcol header="User I D" text="#userID#" />
<cfcol header="Category I D" text="#categoryID#" />
<cfcol header="Title" text="#title#" />
<cfcol header="Body" text="#body#" />
<cfcol header="Date Created" text="#dateCreated#" />
<cfcol header="Date Last Updated" text="#dateLastUpdated#" />
<cfcol header="" text="#linkTo(text='Show', action='show',
key=entryID)#" />
<cfcol header="" text="#linkTo(text='Edit', action='edit',
key=entryID)#" />
<cfcol header="" text="#linkTo(text='Delete', action='delete',
key=entryID, confirm='Are you sure?')#" />
</cftable>

<cfoutput>
<p>#linkTo(text="New entry", action="new")#</p>
</cfoutput>

 This view is using the entries variable set in index action of the
entries controller. The index view shows the content and some links. The
second linkTo() builds a Show link to the show action and passes in a
key. It builds this markup <a href="/entries/show/15">Show</a> if you
have URL Rewriting On. The fourth linkTo() displays Delete, pops a
javascript alert to confirm you want to continue, and if yes passes a
key to the delete action. The Delete linkTo() builds this HTML and
javascript as <a href="/entries/delete/15" onclick="return confirm('Are
you sure?');">.

### Creating New Entry

Creating a new entry consists of two actions. The first is the new
action which instantiates an empty entry object. The second action is to
create an entry via the create action.

#### Action One, Display New page

<cffunction name="new">
<cfset entry = model("Entry").new()>
</cffunction>

The next section we will break down the new entry view. The code may
look intimidating. You don't have to use Wheels helper functions but
hopefully after the explanation you will want to since helpers do just
that - help.

 The /views/entry/new.cfm displays this empty entry to you:

<h1>Create new entry</h1>

<cfoutput>

#errorMessagesFor("entry")#
#startFormTag(action="create")#
#textField(objectName='entry', property='userID', label='User I D')#
#textField(objectName='entry', property='categoryID', label='Category I
D')#
#textField(objectName='entry', property='title', label='Title')#
#textField(objectName='entry', property='body', label='Body')#
#dateTimeSelect(objectName='entry', property='dateCreated',
dateOrder='year,month,day', monthDisplay='abbreviations', label='Date
Created')#
#dateTimeSelect(objectName='entry', property='dateLastUpdated',
dateOrder='year,month,day', monthDisplay='abbreviations', label='Date
Last Updated')#

#submitTag()#
#endFormTag()#

#linkTo(text="Return to the listing", action="index")#
</cfoutput>

Let's begin with errorMessageFor() in /views/entry/new.cfm. It builds
and returns a list containing all the error messages for the Entry model
based on your validation in the model.

Next is the startFormTag() form helper. It builds the starting form tag
and maps it to the create action. The markup created is <form
action="/entries/create" method="post">.
 
The textField() creates a text field populated by the userid property.
The markup it creates is:

<label for="entry-userID">User I D
<input id="entry-userID" name="entry[userID]" type="text" value="" />
</label>

Wheels form helpers may look a little different then you are use to for
creating forms, but hopefully now you understand how they tie your model
into your form. Wheels form helpers are there to help you be more
productive and produce more consistent markup.

#### Action Two, Create New Entry

Finally for the Create new entry, when you click on the submit button,
the browser sends the form information to the create action in the entry
controller.

<cffunction name="create">
<cfset entry = model("Entry").new(params.entry)>
<!--- Verify that the entry creates successfully --->
<cfif entry.save()>
<cfset flashInsert(success="The entry was created successfully.")>
<cfset redirectTo(action="index")>
<!--- Otherwise --->
<cfelse>
<cfset flashInsert(error="There was an error creating the entry.")>
<cfset renderPage(action="new")>
</cfif>
</cffunction>

In the create action, first new() creates a new object based on
params.entry. The params.entry argument passed into new() is the new
form values. The cfif saves the entry object and if successful inserts a
Wheels flash message then redirects to the index action. If not
successful, a Wheels flash message is inserted then the new view is
rendered.

### Showing an Individual Entry

When you click on the show link for an entry from the Listings entries
page, it calls the show action and passes in a key.

 Your show entry URL may look similiar to one of these:

- http://localhost/entries/show/1
- http://localhost/index.cfm/entries/show/1
- http://localhost/index.cfm?controller=entries&show=edit&key=1


Here is the show action in /controllers/entries.cfc:

<cffunction name="show">
<!--- Find the record --->
<cfset entry = model("Entry").findByKey(params.key)>
<!--- Check if the record exists --->
<cfif NOT IsObject(entry)>
<cfset flashInsert(error="Entry #params.key# was not found")>
<cfset redirectTo(action="index")>
</cfif>
</cffunction>

 The show action uses findByKey() to query for the record by the
params.key. If the entry isn't found, the user is directed the Listing
entry page with an message. The entry variable is passed to the
/views/entries/show.cfm since it is in the VARIABLES scope. Here is the
show view:
 
<h1>Showing entry</h1>

<cfoutput>

<p><span>Entry I D</span> <br />
#entry.entryID#</p>
<p><span>User I D</span> <br />
#entry.userID#</p>
<p><span>Category I D</span> <br />
#entry.categoryID#</p>
<p><span>Title</span> <br />
#entry.title#</p>
<p><span>Body</span> <br />
#entry.body#</p>
<p><span>Date Created</span> <br />
#entry.dateCreated#</p>
<p><span>Date Last Updated</span> <br />
#entry.dateLastUpdated#</p>

#linkTo(text="Return to the listing", action="index")# |
#linkTo(text="Edit this entry", action="edit", key=entry.entryID)#
</cfoutput>

 This code displays the entry model object created in the show action.
The linkTo() form helpers are building two links. The first linkTo() is
for going back to the Listings entry page which is the index action. The
second linkTo() is for editing the entry. Notice it is passing in the
primary key for the entry as a key argument.
### Editing an Entry

Similar to creating a new entry, editing an entry is in two parts. The
first is a request to edit with a particular entry key and the second
part is to update the particular entry. "Edit this entry" link calls the
edit action in the entries controller and passes a key to it. Here is
the edit action:

<cffunction name="edit">
<!--- Find the record --->
<cfset entry = model("Entry").findByKey(params.key)>
<!--- Check if the record exists --->
<cfif NOT IsObject(entry)>
<cfset flashInsert(error="Entry #params.key# was not found")>
<cfset redirectTo(action="index")>
</cfif>
</cffunction>

After finding the requested entry, Wheels uses /views/entries/edit.cfm
to display the record. If the entry is not found, you will be redirected
the the Show entries page which you tested out in the "Customizing
Layouts" section to show the Wheels flash message.

When submitting the edit form, the update action is called.

<cffunction name="update">
<cfset entry = model("Entry").findByKey(params.key)>
<!--- Verify that the entry updates successfully --->
<cfif entry.update(params.entry)>
<cfset flashInsert(success="The entry was updated successfully.")>
<cfset redirectTo(action="index")>
<!--- Otherwise --->
<cfelse>
<cfset flashInsert(error="There was an error updating the entry.")>
<cfset renderPage(action="edit")>
</cfif>
</cffunction>

In the update action, the code looks for the specific entry matching the
params.key with the FindByKey(). The model object returned represents a
record as the entry variable. The cfif is checking if the update is
successful. The params.entry argument passed into update() is the edit
form values. They are applied during the update method call. If
successful, a redirect to the index view occurs. If unsuccessful, you
are taken to the edit view.
### Deleting an Entry

Finally, clicking a delete link calls the delete action.

<cffunction name="delete">
<cfset entry = model("Entry").findByKey(params.key)>
<!--- Verify that the entry deletes successfully --->
<cfif entry.delete()>
<cfset flashInsert(success="The entry was deleted successfully.")>
<cfset redirectTo(action="index")>
<!--- Otherwise --->
<cfelse>
<cfset flashInsert(error="There was an error deleting the entry.")>
<cfset redirectTo(action="index")>
</cfif>
</cffunction>

 The delete action removes a matching record from the database. If
successful, you are directed to the index view with a successful Wheels
flash message. If unsuccessful, you are directed to the index view with
an error Wheels flash message.

Our code review is done. Hopefully you noticed how simple Wheels
implements the action and display idea from when you originally learned
ColdFusion. Advance Wheels techniques you can start doing more code
reuse and start overriding the Wheels conventions while still keeping
your code simple and maintainable.